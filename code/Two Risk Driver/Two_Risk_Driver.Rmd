#Two Risk Drivers

Initialize library and import data

```{r}
#Libraries
library("here")
library("mvtnorm")

#import data
load(here("data", "Market.rda"))
```

Calculate the daily log returns

```{r}
rets_SP <- 100*diff(log(Market$sp500))
rets_VIX <- 100*diff(log(Market$vix))

rets <- cbind(rets_SP, rets_VIX)
colnames(rets) <- c("SP500", "VIX")
```

Generate 10,000 scenarios for 1 week ahead underlying price and the one week ahead VIX value using the normal distribution fitted to the past drivers

```{r}
#Assume that the distribution is normally fitted
mu <- apply(rets, 2, mean)

Sigma <- cov(rets)

n_sim <- 100

#Initialize variables
updated_rets <- matrix(NA, n_sim, 2)
rets_day <- matrix(NA, n_sim)

#iterations
set.seed(1234)
for(i in 1:5){
    updated_rets <- rmvnorm(mean = mu, sigma = Sigma, n = n_sim)
    
    if(i == 1){
      rets_day <- updated_rets
    }
    else{
      rets_day <- cbind(rets_day,updated_rets)
    }
    
}
head(rets_day)

colnames(rets_day) <- c("Day 1", "Day 1",
                        "Day 2", "Day 2",
                        "Day 3", "Day 3",
                        "Day 4", "Day 4",
                        "Day 5", "Day 5")


daily_rets <- list(SP500 = rets_day[,c(1, 3, 5, 7, 9)],
                   VIX = rets_day[, c(2, 4, 6, 8, 10)])

head(daily_rets$SP500)
```

Now we need to transform the daily log returns to the value of the underlying

```{r}
#Defining an initial value

init <- c(Market$sp500[length(Market$sp500)],
              Market$vix[length(Market$vix)])

#Converting the returns to price
f_convert_log <- function(initial, l_rets){
  #memory allocation
  out <- matrix(NA, nrow(l_rets), ncol(l_rets))
  
  #change the returns to price multiples
  changes <- exp(l_rets/100)

  #initialize first day
  out[, 1] <- initial*changes[,1]
  
  #loop through the matrix 
  for(i in 2:ncol(l_rets)){
     out[,i] <- out[,(i-1)]*changes[,i]
  }
  
  return(out)
}

```

Assign the underlying price and the VIX

```{r}
prices <- list(SP500 = f_convert_log(initial = init[1], daily_rets$SP500),
               VIX = f_convert_log(initial = init[2], daily_rets$VIX))
```

P&L of book of options

```{r}

```



